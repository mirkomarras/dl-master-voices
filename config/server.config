# HPC Server Configuration

# Request Resources
srun --time=168:00:00 --ntasks-per-node=1 --gres=gpu:1 --mem=128000 --pty /bin/bash

# Project Setup
git clone https://github.com/mirkomarras/dl-master-voices.git
cd /path/to/dl-master-voices/
module load python3/intel/3.6.3
python3 -m virtualenv mvenv
source mvenv/bin/activate
pip install -r requirements.txt
unzip /archive/m/mm11333/data_original.zip
mkdir jobs

# Give rwx permission to data folder
setfacl -m u:mlc761:rwx /archive/m/mm11333/
setfacl -m u:pk91:rwx /archive/m/mm11333/
setfacl -m u:mlc761:rwx /archive/m/mm11333/data_20200706.zip
setfacl -m u:pk91:rwx /archive/m/mm11333/data_20200706.zip
getfacl /archive/m/mm11333/data_20200706.zip

# Give rwx permission to voxceleb1 folders
setfacl -Rm u:mlc761:rwX /beegfs/mm11333/
setfacl -Rm u:pk91:rwX /beegfs/mm11333/
setfacl -Rm u:mlc761:rwX /beegfs/mm11333/data/
setfacl -Rm u:pk91:rwX /beegfs/mm11333/data/
setfacl -Rm u:mlc761:rwX /beegfs/mm11333/data/voxceleb1
setfacl -Rm u:mlc761:rwX /beegfs/mm11333/data/voxceleb2
setfacl -Rm u:pk91:rwX /beegfs/mm11333/data/voxceleb1
setfacl -Rm u:pk91:rwX /beegfs/mm11333/data/voxceleb2
getfacl /beegfs/mm11333/data/voxceleb1
getfacl /beegfs/mm11333/data/voxceleb2

# Create symlinks to voxceleb dataset
ln -s /beegfs/mm11333/data/voxceleb1 ./data/
ln -s /beegfs/mm11333/data/voxceleb2 ./data/

# Prepare for running scripts
srun --time=168:00:00 --ntasks-per-node=1 --gres=gpu:1 --mem=8000 --pty /bin/bash
cd /path/to/dl-master-voices/
source mvenv/bin/activate
module load ffmpeg/intel/3.2.2
module load cuda/10.0.130
module load cudnn/10.0v7.6.2.24

# Port forwarding from your laptop to the server for notebook
sbatch ./notebooks/run_jupyterlab_cpu.sbatch
ssh -L 7853:localhost:7853 mm11333@prince.hpc.nyu.edu


